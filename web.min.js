var MITO=function(e){"use strict";var t,n,r,o,i,a,s,c,u,l=function(){return(l=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},p=function(){return(p=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)};!function(e){e.UNKNOWN="UNKNOWN",e.UNKNOWN_FUNCTION="UNKNOWN_FUNCTION",e.JAVASCRIPT_ERROR="JAVASCRIPT_ERROR",e.LOG_ERROR="LOG_ERROR",e.FETCH_ERROR="HTTP_ERROR",e.VUE_ERROR="VUE_ERROR",e.REACT_ERROR="REACT_ERROR",e.RESOURCE_ERROR="RESOURCE_ERROR",e.PROMISE_ERROR="PROMISE_ERROR",e.ROUTE_ERROR="ROUTE_ERROR"}(t||(t={})),function(e){e.AppOnLaunch="AppOnLaunch",e.AppOnShow="AppOnShow",e.AppOnHide="AppOnHide",e.AppOnError="AppOnError",e.AppOnPageNotFound="AppOnPageNotFound",e.AppOnUnhandledRejection="AppOnUnhandledRejection"}(n||(n={})),function(e){e.PageOnLoad="PageOnLoad",e.PageOnShow="PageOnShow",e.PageOnHide="PageOnHide",e.PageOnReady="PageOnReady",e.PageOnUnload="PageOnUnload",e.PageOnShareAppMessage="PageOnShareAppMessage",e.PageOnShareTimeline="PageOnShareTimeline",e.PageOnTabItemTap="PageOnTabItemTap"}(r||(r={})),function(e){e.SwitchTab="switchTab",e.ReLaunch="reLaunch",e.RedirectTo="redirectTo",e.NavigateTo="navigateTo",e.NavigateBack="navigateBack",e.NavigateToMiniProgram="navigateToMiniProgram",e.RouteFail="routeFail"}(o||(o={})),p(p(p({},n),r),t),function(e){e.ROUTE="Route",e.CLICK="UI.Click",e.CONSOLE="Console",e.XHR="Xhr",e.FETCH="Fetch",e.UNHANDLEDREJECTION="Unhandledrejection",e.VUE="Vue",e.REACT="React",e.RESOURCE="Resource",e.CODE_ERROR="Code Error",e.CUSTOMER="Customer",e.APP_ON_SHOW="App On Show",e.APP_ON_LAUNCH="App On Launch",e.APP_ON_HIDE="App On Hide",e.PAGE_ON_SHOW="Page On Show",e.PAGE_ON_HIDE="Page On Hide",e.PAGE_ON_UNLOAD="Page On Unload",e.PAGE_ON_SHARE_APP_MESSAGE="Page On Share App Message",e.PAGE_ON_SHARE_TIMELINE="Page On Share Timeline",e.PAGE_ON_TAB_ITEM_TAP="Page On Tab Item Tap",e.TAP="UI.Tap",e.TOUCHMOVE="UI.Touchmove"}(i||(i={})),function(e){e.HTTP="http",e.USER="user",e.DEBUG="debug",e.EXCEPTION="exception",e.LIFECYCLE="lifecycle"}(a||(a={})),function(e){e.XHR="xhr",e.FETCH="fetch",e.CONSOLE="console",e.DOM="dom",e.HISTORY="history",e.ERROR="error",e.HASHCHANGE="hashchange",e.UNHANDLEDREJECTION="unhandledrejection",e.MITO="mito",e.VUE="Vue",e.MINI_ROUTE="miniRoute",e.MINI_PERFORMANCE="miniPerformance",e.MINI_MEMORY_WARNING="miniMemoryWarning",e.MINI_NETWORK_STATUS_CHANGE="miniNetworkStatusChange",e.MINI_BATTERY_INFO="miniBatteryInfo"}(s||(s={})),function(e){e.XHR="xhr",e.FETCH="fetch"}(c||(c={})),function(e){e[e.BAD_REQUEST=400]="BAD_REQUEST",e[e.UNAUTHORIZED=401]="UNAUTHORIZED",e[e.INTERNAL_EXCEPTION=500]="INTERNAL_EXCEPTION"}(u||(u={}));var f=/^(?:[Uu]ncaught (?:exception: )?)?(?:((?:Eval|Internal|Range|Reference|Syntax|Type|URI|)Error): )?(.*)$/,h={isLogAddBreadcrumb:!0,crossOriginThreshold:1e3},d=function(){return(d=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)};function g(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;var r=Array(e),o=0;for(t=0;t<n;t++)for(var i=arguments[t],a=0,s=i.length;a<s;a++,o++)r[o]=i[a];return r}var O=Object.prototype.toString;function E(e){return function(t){return O.call(t)==="[object "+e+"]"}}var R={isNumber:E("Number"),isString:E("String"),isBoolean:E("Boolean"),isNull:E("Null"),isUndefined:E("Undefined"),isSymbol:E("Symbol"),isFunction:E("Function"),isObject:E("Object"),isArray:E("Array"),isProcess:E("process"),isWindow:E("Window")};function m(e){switch(O.call(e)){case"[object Error]":case"[object Exception]":case"[object DOMException]":return!0;default:return function(e,t){try{return e instanceof t}catch(e){return!1}}(e,Error)}}function y(e){return R.isString(e)&&""===e.trim()||null==e}var v=R.isProcess("undefined"!=typeof process?process:0),T=R.isObject("undefined"!=typeof wx?wx:0)&&R.isFunction("undefined"!=typeof App?App:0),N=R.isWindow("undefined"!=typeof window?window:0);var b=N?window:T?wx:v?process:void 0,A=(b.__MITO__=b.__MITO__||{},b.__MITO__);A.replaceFlag=A.replaceFlag||{};var I=A.replaceFlag;function _(e,t){I[e]||(I[e]=t)}function S(e){return!!I[e]}var U="MITO Logger",x=function(){function e(){var e=this;if(this.enabled=!1,this._console={},b.console=console||b.console,console||b.console){["log","debug","info","warn","error","assert"].forEach((function(t){t in b.console&&(e._console[t]=b.console[t])}))}}return e.prototype.disable=function(){this.enabled=!1},e.prototype.bindOptions=function(e){this.enabled=!!e},e.prototype.enable=function(){this.enabled=!0},e.prototype.getEnableStatus=function(){return this.enabled},e.prototype.log=function(){for(var e,t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];this.enabled&&(e=this._console).log.apply(e,g([U+"[Log]:"],t))},e.prototype.warn=function(){for(var e,t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];this.enabled&&(e=this._console).warn.apply(e,g([U+"[Warn]:"],t))},e.prototype.error=function(){for(var e,t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];this.enabled&&(e=this._console).error.apply(e,g([U+"[Error]:"],t))},e}(),C=A.logger||(A.logger=new x);function P(){return"undefined"==typeof document||null==document.location?"":document.location.href}function H(e,t,n,r){void 0===r&&(r=!1),e.addEventListener(t,n,r)}function k(e,t,n,r){if(void 0===r&&(r=!1),void 0!==e&&(t in e||r)){var o=n(e[t]);"function"==typeof o&&(e[t]=o)}}function D(){return Date.now()}function w(e,t,n){return!!function(e,t){return typeof e===t}(e,n)||(void 0!==e&&C.error(t+"期望传入"+n+"类型，目前是"+typeof e+"类型"),!1)}function L(e,t,n){return!!function(e,t){return O.call(e)===t}(e,n)||(void 0!==e&&C.error(t+"期望传入"+n+"类型，目前是"+O.call(e)+"类型"),!1)}function M(e){h.isLogAddBreadcrumb=!1,e(),h.isLogAddBreadcrumb=!0}function F(e){return R.isString(e)?e:R.isUndefined(e)?"undefined":JSON.stringify(e)}function j(e){return Number(e.split(".")[0])}function W(e,t){return R.isString(e)?e.slice(0,t)+(e.length>t?":截取前"+t+"个字符":""):""}function G(){if(!R.isFunction(getCurrentPages))return"";var e=getCurrentPages();if(!e.length)return"App";var t,n,r,o=e.pop();return t=o.route,n=o.options,r=[],Object.keys(n).forEach((function(e){r.push(e+"="+n[e])})),t=-1!==t.indexOf("?")?t+"&"+r.join("&"):t+"?"+r.join("&")}function V(e){if(!e)return{};var t=e.match(/^(([^:\/?#]+):)?(\/\/([^\/?#]*))?([^?#]*)(\?([^#]*))?(#(.*))?$/);if(!t)return{};var n=t[6]||"",r=t[8]||"";return{host:t[4],path:t[5],protocol:t[2],relative:t[5]+n+r}}function X(e,n){var r={time:D(),url:P(),name:e.name,level:n,message:e.message};if(void 0===e.stack||!e.stack)return r;for(var o,i,a,s=/^\s*at (.*?) ?\(((?:file|https?|blob|chrome-extension|native|eval|webpack|<anonymous>|[a-z]:|\/).*?)(?::(\d+))?(?::(\d+))?\)?\s*$/i,c=/^\s*(.*?)(?:\((.*?)\))?(?:^|@)((?:file|https?|blob|chrome|webpack|resource|\[native).*?|[^@]*bundle)(?::(\d+))?(?::(\d+))?\s*$/i,u=/^\s*at (?:((?:\[object object\])?.+) )?\(?((?:file|ms-appx|https?|webpack|blob):.*?):(\d+)(?::(\d+))?\)?\s*$/i,l=/(\S+) line (\d+)(?: > eval line \d+)* > eval/i,p=/\((\S*)(?::(\d+))(?::(\d+))\)/,f=e.stack.split("\n"),h=[],g=0,O=f.length;g<O;++g){if(i=s.exec(f[g])){var E=i[2]&&0===i[2].indexOf("native");i[2]&&0===i[2].indexOf("eval")&&(o=p.exec(i[2]))&&(i[2]=o[1],i[3]=o[2],i[4]=o[3]),a={url:E?null:i[2],func:i[1]||t.UNKNOWN_FUNCTION,args:E?[i[2]]:[],line:i[3]?+i[3]:null,column:i[4]?+i[4]:null}}else if(i=u.exec(f[g]))a={url:i[2],func:i[1]||t.UNKNOWN_FUNCTION,args:[],line:+i[3],column:i[4]?+i[4]:null};else{if(!(i=c.exec(f[g])))continue;i[3]&&i[3].indexOf(" > eval")>-1&&(o=l.exec(i[3]))?(i[3]=o[1],i[4]=o[2],i[5]=null):0!==g||i[5]||void 0===e.columnNumber||(h[0].column=e.columnNumber+1),a={url:i[3],func:i[1]||t.UNKNOWN_FUNCTION,args:i[2]?i[2].split(","):[],line:i[4]?+i[4]:null,column:i[5]?+i[5]:null}}!a.func&&a.line&&(a.func=t.UNKNOWN_FUNCTION),h.push(a)}return h.length?d(d({},r),{stack:h}):null}var B,K,q,$,J=function(){function e(){this.stack=[],this.isFlushing=!1,"Promise"in b&&(this.micro=Promise.resolve())}return e.prototype.addFn=function(e){var t=this;"function"==typeof e&&("Promise"in b?(this.stack.push(e),this.isFlushing||(this.isFlushing=!0,this.micro.then((function(){return t.flushStack()})))):e())},e.prototype.clear=function(){this.stack=[]},e.prototype.getStack=function(){return this.stack},e.prototype.flushStack=function(){var e=this.stack.slice(0);this.stack.length=0,this.isFlushing=!1;for(var t=0;t<e.length;t++)e[t]()},e}();function Y(e){return void 0===e.actionType&&!e.isTrackData}!function(e){e.Else="else",e.Error="error",e.Warning="warning",e.Info="info",e.Debug="debug",e.Low="low",e.Normal="normal",e.High="high",e.Critical="critical"}(B||(B={})),function(e){e.fromString=function(t){switch(t){case"debug":return e.Debug;case"info":case"log":case"assert":return e.Info;case"warn":case"warning":return e.Warning;case e.Low:case e.Normal:case e.High:case e.Critical:case"error":return e.Error;default:return e.Else}}}(B||(B={})),function(e){e.Ok="ok",e.DeadlineExceeded="deadline_exceeded",e.Unauthenticated="unauthenticated",e.PermissionDenied="permission_denied",e.NotFound="not_found",e.ResourceExhausted="resource_exhausted",e.InvalidArgument="invalid_argument",e.Unimplemented="unimplemented",e.Unavailable="unavailable",e.InternalError="internal_error",e.UnknownError="unknown_error",e.Cancelled="cancelled",e.AlreadyExists="already_exists",e.FailedPrecondition="failed_precondition",e.Aborted="aborted",e.OutOfRange="out_of_range",e.DataLoss="data_loss"}(K||(K={})),function(e){e.Get="GET",e.Post="POST",e.Put="PUT",e.Delete="DELETE"}(q||(q={})),function(e){e.PAGE="PAGE",e.EVENT="EVENT",e.VIEW="VIEW",e.DURATION="DURATION",e.DURATION_VIEW="DURATION_VIEW",e.OTHER="OTHER"}($||($={}));var Z=function(){function e(){this.maxBreadcrumbs=10,this.beforePushBreadcrumb=null,this.stack=[]}return e.prototype.push=function(e){var t=this;if("function"!=typeof this.beforePushBreadcrumb)this.immediatePush(e);else{var n=null,r=this.beforePushBreadcrumb;if(M((function(){n=r(t,e)})),!n)return;this.immediatePush(n)}},e.prototype.immediatePush=function(e){e.time||(e.time=D()),this.stack.length>=this.maxBreadcrumbs&&this.shift(),this.stack.push(e),this.stack.sort((function(e,t){return e.time-t.time})),C.log(this.stack)},e.prototype.shift=function(){return void 0!==this.stack.shift()},e.prototype.clear=function(){this.stack=[]},e.prototype.getStack=function(){return this.stack},e.prototype.getCategory=function(e){switch(e){case i.XHR:case i.FETCH:return a.HTTP;case i.CLICK:case i.ROUTE:case i.TAP:case i.TOUCHMOVE:return a.USER;case i.CUSTOMER:case i.CONSOLE:return a.DEBUG;case i.APP_ON_LAUNCH:case i.APP_ON_SHOW:case i.APP_ON_HIDE:case i.PAGE_ON_SHOW:case i.PAGE_ON_HIDE:case i.PAGE_ON_SHARE_APP_MESSAGE:case i.PAGE_ON_SHARE_TIMELINE:case i.PAGE_ON_TAB_ITEM_TAP:return a.LIFECYCLE;case i.UNHANDLEDREJECTION:case i.CODE_ERROR:case i.RESOURCE:case i.VUE:case i.REACT:default:return a.EXCEPTION}},e.prototype.bindOptions=function(e){void 0===e&&(e={});var t=e.maxBreadcrumbs,n=e.beforePushBreadcrumb;w(t,"maxBreadcrumbs","number")&&(this.maxBreadcrumbs=t),w(n,"beforePushBreadcrumb","function")&&(this.beforePushBreadcrumb=n)},e}(),z=A.breadcrumb||(A.breadcrumb=new Z),Q=function(){return(Q=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)};function ee(e,t,n,r){return new(n||(n=Promise))((function(o,i){function a(e){try{c(r.next(e))}catch(e){i(e)}}function s(e){try{c(r.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}c((r=r.apply(e,t||[])).next())}))}function te(e,t){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=a.trys,(o=o.length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}}var ne=function(){function e(){this.beforeAppAjaxSend=function(){},this.traceIdFieldName="Trace-Id",this.throttleDelayTime=0,this.maxDuplicateCount=2,this.appOnLaunch=function(){},this.appOnShow=function(){},this.onPageNotFound=function(){},this.appOnHide=function(){},this.pageOnUnload=function(){},this.pageOnShow=function(){},this.pageOnHide=function(){},this.onShareAppMessage=function(){},this.onShareTimeline=function(){},this.onTabItemTap=function(){},this.triggerWxEvent=function(){},this.enableTraceId=!1}return e.prototype.bindOptions=function(e){void 0===e&&(e={});var t=e.beforeAppAjaxSend,n=e.enableTraceId,r=e.filterXhrUrlRegExp,o=e.traceIdFieldName,i=e.throttleDelayTime,a=e.includeHttpUrlTraceIdRegExp,s=e.appOnLaunch,c=e.appOnShow,u=e.appOnHide,l=e.pageOnUnload,p=e.pageOnShow,f=e.pageOnHide,h=e.onPageNotFound,d=e.onShareAppMessage,g=e.onShareTimeline,O=e.onTabItemTap,E=e.wxNavigateToMiniProgram,R=e.triggerWxEvent,m=e.maxDuplicateCount;w(t,"beforeAppAjaxSend","function")&&(this.beforeAppAjaxSend=t),w(s,"appOnLaunch","function")&&(this.appOnLaunch=s),w(c,"appOnShow","function")&&(this.appOnShow=c),w(u,"appOnHide","function")&&(this.appOnHide=u),w(l,"pageOnUnload","function")&&(this.pageOnUnload=l),w(p,"pageOnShow","function")&&(this.pageOnShow=p),w(f,"pageOnHide","function")&&(this.pageOnHide=f),w(h,"onPageNotFound","function")&&(this.onPageNotFound=h),w(d,"onShareAppMessage","function")&&(this.onShareAppMessage=d),w(g,"onShareTimeline","function")&&(this.onShareTimeline=g),w(O,"onTabItemTap","function")&&(this.onTabItemTap=O),w(E,"wxNavigateToMiniProgram","function")&&(this.wxNavigateToMiniProgram=E),w(R,"triggerWxEvent","function")&&(this.triggerWxEvent=R),w(n,"enableTraceId","boolean")&&(this.enableTraceId=n),w(o,"traceIdFieldName","string")&&(this.traceIdFieldName=o),w(i,"throttleDelayTime","number")&&(this.throttleDelayTime=i),w(m,"maxDuplicateCount","number")&&(this.maxDuplicateCount=m),L(r,"filterXhrUrlRegExp","[object RegExp]")&&(this.filterXhrUrlRegExp=r),L(a,"includeHttpUrlTraceIdRegExp","[object RegExp]")&&(this.includeHttpUrlTraceIdRegExp=a)},e}(),re=A.options||(A.options=new ne);function oe(e,t){var n,r=re.includeHttpUrlTraceIdRegExp;if(re.enableTraceId&&r&&r.test(e)){var o=(n=(new Date).getTime(),"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){var t=(n+16*Math.random())%16|0;return n=Math.floor(n/16),("x"==e?t:3&t|8).toString(16)})));t(re.traceIdFieldName,o)}}function ie(e){void 0===e&&(e={}),function(e){void 0===e&&(e={}),_(s.XHR,!!e.silentXhr),_(s.FETCH,!!e.silentFetch),_(s.CONSOLE,!!e.silentConsole),_(s.DOM,!!e.silentDom),_(s.HISTORY,!!e.silentHistory),_(s.ERROR,!!e.silentError),_(s.HASHCHANGE,!!e.silentHashchange),_(s.UNHANDLEDREJECTION,!!e.silentUnhandledrejection),_(s.VUE,!!e.silentVue),_(n.AppOnError,!!e.silentWxOnError),_(n.AppOnUnhandledRejection,!!e.silentUnhandledrejection),_(n.AppOnPageNotFound,!!e.silentWxOnPageNotFound),_(r.PageOnShareAppMessage,!!e.silentWxOnShareAppMessage),_(s.MINI_ROUTE,!!e.silentMiniRoute)}(e),z.bindOptions(e),C.bindOptions(e.debug),pe.bindOptions(e),re.bindOptions(e)}var ae={};function se(e,n){var r;switch(e.type){case t.FETCH_ERROR:r=e.type+e.request.method+e.response.status+ue(e.request.url)+n;break;case t.JAVASCRIPT_ERROR:case t.VUE_ERROR:case t.REACT_ERROR:r=e.type+e.name+e.message+n;break;case t.LOG_ERROR:r=e.customTag+e.type+e.name+n;break;case t.PROMISE_ERROR:r=function(e,t){var n=ue(e.url);if(e.name===s.UNHANDLEDREJECTION)return e.type+ce(e.message)+t;return e.type+e.name+ce(e.message)+n}(e,n);break;default:r=e.type+e.message+n}return r=function(e){var t=0;if(0==e.length)return t;for(var n=0;n<e.length;n++){var r=e.charCodeAt(n);t=(t<<5)-t+r,t&=t}return t}(r),ae[r]>=re.maxDuplicateCount?null:("number"==typeof ae[r]?ae[r]++:ae[r]=1,r)}function ce(e){var t=function(e){return Object.keys(e).sort().reduce((function(n,r){return R.isObject(e[r])?n[r]=t(e[r]):n[r]=e[r],n}),{})};try{if(/\{.*\}/.test(e)){var n=JSON.parse(e);return n=t(n),JSON.stringify(n)}}catch(t){return e}}function ue(e){return e.replace(/[\?#].*$/,"").replace(/\/\d+([\/]*$)/,"{param}$1")}var le=function(){function e(){this.beforeDataReport=null,this.backTrackerId=null,this.configReportXhr=null,this.configReportUrl=null,this.configReportWxRequest=null,this.useImgUpload=!1,this.apikey="",this.trackKey="",this.errorDsn="",this.trackDsn="",this.queue=new J}return e.prototype.imgRequest=function(e,t){this.queue.addFn((function(){var n=new Image,r=-1===t.indexOf("?")?"?":"&";n.src=""+t+r+"data="+encodeURIComponent(JSON.stringify(e)),n=null}))},e.prototype.getRecord=function(){var e=A.record;return e&&R.isArray(e)&&e.length>2?e:[]},e.prototype.getDeviceInfo=function(){return A.deviceInfo||{}},e.prototype.beforePost=function(e){return ee(this,void 0,void 0,(function(){var t,n;return te(this,(function(r){switch(r.label){case 0:if(Y(e)){if(!(t=se(e,this.apikey)))return[2,!1];e.errorId=t}return n=this.getTransportData(e),"function"!=typeof this.beforeDataReport?[3,2]:[4,this.beforeDataReport(n)];case 1:if(!(n=r.sent()))return[2,!1];r.label=2;case 2:return[2,n]}}))}))},e.prototype.xhrPost=function(e,t){return ee(this,void 0,void 0,(function(){var n,r=this;return te(this,(function(o){return n=function(){var n=new XMLHttpRequest;n.open(q.Post,t),n.setRequestHeader("Content-Type","application/json;charset=UTF-8"),n.withCredentials=!0,"function"==typeof r.configReportXhr&&r.configReportXhr(n,e),n.send(JSON.stringify(e))},this.queue.addFn(n),[2]}))}))},e.prototype.wxPost=function(e,t){return ee(this,void 0,void 0,(function(){var n,r=this;return te(this,(function(o){return n=function(){var n={method:"POST"};if("function"==typeof r.configReportWxRequest){var o=r.configReportWxRequest(e);n=Q(Q({},n),o)}n=Q(Q({},n),{data:JSON.stringify(e),url:t}),wx.request(n)},this.queue.addFn(n),[2]}))}))},e.prototype.getAuthInfo=function(){var e=this.getTrackerId(),t={trackerId:String(e),sdkVersion:"2.1.28",sdkName:"@zyf2e/monitor"};return this.apikey&&(t.apikey=this.apikey),this.trackKey&&(t.trackKey=this.trackKey),t},e.prototype.getApikey=function(){return this.apikey},e.prototype.getTrackKey=function(){return this.trackKey},e.prototype.getTrackerId=function(){if("function"==typeof this.backTrackerId){var e=this.backTrackerId();if("string"==typeof e||"number"==typeof e)return e;C.error("trackerId:"+e+" 期望 string 或 number 类型，但是传入 "+typeof e)}return""},e.prototype.getTransportData=function(e){return{authInfo:this.getAuthInfo(),breadcrumb:z.getStack(),data:e,record:this.getRecord(),deviceInfo:this.getDeviceInfo()}},e.prototype.isSdkTransportUrl=function(e){var t=!1;return this.errorDsn&&-1!==e.indexOf(this.errorDsn)&&(t=!0),this.trackDsn&&-1!==e.indexOf(this.trackDsn)&&(t=!0),t},e.prototype.bindOptions=function(e){void 0===e&&(e={});var t=e.dsn,n=e.beforeDataReport,r=e.apikey,o=e.configReportXhr,i=e.backTrackerId,a=e.trackDsn,s=e.trackKey,c=e.configReportUrl,u=e.useImgUpload,l=e.configReportWxRequest;w(r,"apikey","string")&&(this.apikey=r),w(s,"trackKey","string")&&(this.trackKey=s),w(t,"dsn","string")&&(this.errorDsn=t),w(a,"trackDsn","string")&&(this.trackDsn=a),w(u,"useImgUpload","boolean")&&(this.useImgUpload=u),w(n,"beforeDataReport","function")&&(this.beforeDataReport=n),w(o,"configReportXhr","function")&&(this.configReportXhr=o),w(i,"backTrackerId","function")&&(this.backTrackerId=i),w(c,"configReportUrl","function")&&(this.configReportUrl=c),w(l,"configReportWxRequest","function")&&(this.configReportWxRequest=l)},e.prototype.send=function(e){return ee(this,void 0,void 0,(function(){var t,n;return te(this,(function(r){switch(r.label){case 0:if(t="",Y(e)){if(y(t=this.errorDsn))return C.error("dsn为空，没有传入监控错误上报的dsn地址，请在init中传入"),[2]}else if(y(t=this.trackDsn))return C.error("trackDsn为空，没有传入埋点上报的dsn地址，请在init中传入"),[2];return[4,this.beforePost(e)];case 1:return(n=r.sent())&&("function"!=typeof this.configReportUrl||(t=this.configReportUrl(n,t)))?N?[2,this.useImgUpload?this.imgRequest(n,t):this.xhrPost(n,t)]:T?[2,this.wxPost(n,t)]:[2]:[2]}}))}))},e}(),pe=A.transportData||(A.transportData=new le);function fe(e){var n="",r=e.elapsedTime,o=e.time,i=e.method,a=e.traceId,s=e.type,c=e.status,u=s+"--"+i;return n=(n=0===c?r<=h.crossOriginThreshold?"http请求失败，失败原因：跨域限制或域名不存在":"http请求失败，失败原因：超时":function(e){if(e<400)return K.Ok;if(e>=400&&e<500)switch(e){case 401:return K.Unauthenticated;case 403:return K.PermissionDenied;case 404:return K.NotFound;case 409:return K.AlreadyExists;case 413:return K.FailedPrecondition;case 429:return K.ResourceExhausted;default:return K.InvalidArgument}if(e>=500&&e<600)switch(e){case 501:return K.Unimplemented;case 503:return K.Unavailable;case 504:return K.DeadlineExceeded;default:return K.InternalError}return K.UnknownError}(c))===K.Ok?n:n+" "+ue(e.url),{type:t.FETCH_ERROR,url:P(),time:o,elapsedTime:r,level:B.Low,message:n,name:u,request:{httpType:s,traceId:a,method:i,url:e.url,data:e.reqData||""},response:{status:c,data:e.responseText}}}var he={img:"图片",script:"js脚本"};var de={};function ge(e,t){e&&de[e]&&de[e].forEach((function(n){!function(e,t){try{e()}catch(e){console.log("err",e),t&&t(e)}}((function(){n(t)}),(function(t){var r;C.error("重写事件triggerHandlers的回调函数发生错误\nType:"+e+"\nName: "+(((r=n)&&"function"==typeof r&&r.name||"<anonymous>")+"\nError: ")+t)}))}))}var Oe,Ee={handleHttp:function(e,t){var n=0===e.status||e.status===u.BAD_REQUEST||e.status>u.UNAUTHORIZED,r=fe(e);z.push({type:t,category:z.getCategory(t),data:l({},r),level:B.Info,time:e.time}),n&&(z.push({type:t,category:z.getCategory(i.CODE_ERROR),data:l({},r),level:B.Error,time:e.time}),pe.send(r))},handleError:function(e){if(e.target.localName){var n=function(e){return{type:t.RESOURCE_ERROR,url:P(),message:"资源地址: "+(W(e.src,120)||W(e.href,120)),level:B.Low,time:D(),name:(he[e.localName]||e.localName)+"加载失败"}}(e.target);return z.push({type:i.RESOURCE,category:z.getCategory(i.RESOURCE),data:n,level:B.Error}),pe.send(n)}var r,o=e.message,a=e.filename,s=e.lineno,c=e.colno,u=e.error;u&&m(u)&&(r=X(u,B.Normal)),r||(r=Ee.handleNotErrorInstance(o,a,s,c)),r.type=t.JAVASCRIPT_ERROR,z.push({type:i.CODE_ERROR,category:z.getCategory(i.CODE_ERROR),data:l({},r),level:B.Error}),pe.send(r)},handleNotErrorInstance:function(e,n,r,o){var i=t.UNKNOWN,a=n||P(),s=e,c=e.match(f);c[1]&&(i=c[1],s=c[2]);var u={url:a,func:t.UNKNOWN_FUNCTION,args:t.UNKNOWN,line:r,col:o};return{url:a,name:i,message:s,level:B.Normal,time:D(),stack:[u]}},handleHistory:function(e){var t=e.from,n=e.to,r=V(t).relative,o=V(n).relative;z.push({type:i.ROUTE,category:z.getCategory(i.ROUTE),data:{from:r||"/",to:o||"/"},level:B.Info})},handleHashchange:function(e){var t=e.oldURL,n=e.newURL,r=V(t).relative,o=V(n).relative;z.push({type:i.ROUTE,category:z.getCategory(i.ROUTE),data:{from:r,to:o},level:B.Info})},handleUnhandleRejection:function(e){var n={type:t.PROMISE_ERROR,message:F(e.reason),url:P(),name:e.type,time:D(),level:B.Low};m(e.reason)&&(n=l(l({},n),X(e.reason,B.Low))),z.push({type:i.UNHANDLEDREJECTION,category:z.getCategory(i.UNHANDLEDREJECTION),data:l({},n),level:B.Error}),pe.send(n)}};function Re(e){return re.filterXhrUrlRegExp&&re.filterXhrUrlRegExp.test(e)}function me(e){switch(e){case s.XHR:!function(){if(!("XMLHttpRequest"in b))return;var e=XMLHttpRequest.prototype;k(e,"open",(function(e){return function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];this.mito_xhr={method:R.isString(t[0])?t[0].toUpperCase():t[0],url:t[1],sTime:D(),type:c.XHR},e.apply(this,t)}})),k(e,"send",(function(e){return function(){for(var t=this,n=[],r=0;r<arguments.length;r++)n[r]=arguments[r];var o=this.mito_xhr,i=o.method,a=o.url;oe(a,(function(e,n){t.mito_xhr.traceId=n,t.setRequestHeader(e,n)})),re.beforeAppAjaxSend&&re.beforeAppAjaxSend({method:i,url:a},this),H(this,"loadend",(function(){if(!(i===q.Post&&pe.isSdkTransportUrl(a)||Re(a))){var e=this.responseType,t=this.response,r=this.status;this.mito_xhr.reqData=n[0];var o=D();this.mito_xhr.time=this.mito_xhr.sTime,this.mito_xhr.status=r,-1!==["","json","text"].indexOf(e)&&(this.mito_xhr.responseText="object"==typeof t?JSON.stringify(t):t),this.mito_xhr.elapsedTime=o-this.mito_xhr.sTime,ge(s.XHR,this.mito_xhr)}})),e.apply(this,n)}}))}();break;case s.FETCH:!function(){if(!("fetch"in b))return;k(b,s.FETCH,(function(e){return function(t,n){void 0===n&&(n={});var r=D(),o=n&&n.method||"GET",i={type:c.FETCH,method:o,reqData:n&&n.body,url:t},a=new Headers(n.headers||{});return Object.assign(a,{setRequestHeader:a.set}),oe(t,(function(e,t){i.traceId=t,a.set(e,t)})),re.beforeAppAjaxSend&&re.beforeAppAjaxSend({method:o,url:t},a),n=l(l({},n),{headers:a}),e.apply(b,[t,n]).then((function(e){var n=e.clone(),a=D();return i=l(l({},i),{elapsedTime:a-r,status:n.status,time:r}),n.text().then((function(e){o===q.Post&&pe.isSdkTransportUrl(t)||Re(t)||(i.responseText=n.status>u.UNAUTHORIZED&&e,ge(s.FETCH,i))})),e}),(function(e){var n=D();if(!(o===q.Post&&pe.isSdkTransportUrl(t)||Re(t)))throw i=l(l({},i),{elapsedTime:n-r,status:0,time:r}),ge(s.FETCH,i),e}))}}))}();break;case s.ERROR:H(b,"error",(function(e){ge(s.ERROR,e)}),!0);break;case s.CONSOLE:!function(){if(!("console"in b))return;["log","debug","info","warn","error","assert"].forEach((function(e){e in b.console&&k(b.console,e,(function(t){return function(){for(var n=[],r=0;r<arguments.length;r++)n[r]=arguments[r];t&&(ge(s.CONSOLE,{args:n,level:e}),t.apply(b.console,n))}}))}))}();break;case s.HISTORY:!function(){if(e=b.chrome,t=e&&e.app&&e.app.runtime,n="history"in b&&!!b.history.pushState&&!!b.history.replaceState,t||!n)return;var e,t,n;var r=b.onpopstate;function o(e){return function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];var r=t.length>2?t[2]:void 0;if(r){var o=Oe,i=String(r);Oe=i,ge(s.HISTORY,{from:o,to:i})}return e.apply(this,t)}}b.onpopstate=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=P(),o=Oe;Oe=n,ge(s.HISTORY,{from:o,to:n}),r&&r.apply(this,e)},k(b.history,"pushState",o),k(b.history,"replaceState",o)}();break;case s.UNHANDLEDREJECTION:H(b,s.UNHANDLEDREJECTION,(function(e){ge(s.UNHANDLEDREJECTION,e)}));break;case s.DOM:!function(){if(!("document"in b))return;var e=(t=ge,n=re.throttleDelayTime,r=!0,function(){for(var e=[],o=0;o<arguments.length;o++)e[o]=arguments[o];r&&(t.apply(this,e),r=!1,setTimeout((function(){r=!0}),n))});var t,n,r;H(b.document,"click",(function(){e(s.DOM,{category:"click",data:this})}),!0)}();break;case s.HASHCHANGE:t="onpopstate",b.hasOwnProperty(t)||H(b,s.HASHCHANGE,(function(e){ge(s.HASHCHANGE,e)}))}var t}function ye(e){(function(e){return!(!e||S(e.type))&&(_(e.type,!0),de[e.type]=de[e.type]||[],de[e.type].push(e.callback),!0)})(e)&&me(e.type)}function ve(){ye({callback:function(e){Ee.handleHttp(e,i.XHR)},type:s.XHR}),ye({callback:function(e){Ee.handleHttp(e,i.FETCH)},type:s.FETCH}),ye({callback:function(e){Ee.handleError(e)},type:s.ERROR}),ye({callback:function(e){!function(e){h.isLogAddBreadcrumb&&z.push({type:i.CONSOLE,category:z.getCategory(i.CONSOLE),data:e,level:B.fromString(e.level)})}(e)},type:s.CONSOLE}),ye({callback:function(e){Ee.handleHistory(e)},type:s.HISTORY}),ye({callback:function(e){Ee.handleUnhandleRejection(e)},type:s.UNHANDLEDREJECTION}),ye({callback:function(e){var t=function(e){var t=e.tagName.toLowerCase();if("body"===t)return null;var n=e.classList.value;return n=""!==n?' class="'+n+'"':"","<"+t+(e.id?' id="'+e.id+'"':"")+(""!==n?n:"")+">"+e.innerText+"</"+t+">"}(e.data.activeElement);t&&z.push({type:i.CLICK,category:z.getCategory(i.CLICK),data:t,level:B.Info}),console.log(t)},type:s.DOM}),ye({callback:function(e){Ee.handleHashchange(e)},type:s.HASHCHANGE})}Oe=P();var Te=function(){return(Te=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)};function Ne(e,n,r,o,a,s){var c=null==s?void 0:s.version,u={type:t.VUE_ERROR,message:e.message+"("+r+")",level:o,url:P(),name:e.name,stack:e.stack||[],time:D()};if(R.isString(c))switch(console.log("getBigVersion",j(c)),j(c)){case 2:u=Te(Te({},u),function(e){var t="";if(e.$root===e)t="root";else{var n=e._isVue?e.$options&&e.$options.name||e.$options&&e.$options._componentTag:e.name;t=(n?"component <"+n+">":"anonymous component")+(e._isVue&&e.$options&&e.$options.__file?" at "+(e.$options&&e.$options.__file):"")}return{componentName:t,propsData:e.$options&&e.$options.propsData}}(n));break;case 3:u=Te(Te({},u),function(e){var t="";if(e.$root===e)t="root";else{console.log(e.$options);var n=e.$options&&e.$options.name;t=n?"component <"+n+">":"anonymous component"}return{componentName:t,propsData:e.$props}}(n));break;default:return}z.push({type:i.VUE,category:z.getCategory(i.VUE),data:u,level:a}),pe.send(u)}var be="undefined"!=typeof console,Ae={install:function(e){!S(s.VUE)&&e&&e.config&&(_(s.VUE,!0),e.config.errorHandler=function(t,n,r){Ne.apply(null,[t,n,r,B.Normal,B.Error,e]),be&&!e.config.silent&&M((function(){console.error("Error in "+r+': "'+t.toString()+'"',n),console.error(t)}))})}};return e.MitoVue=Ae,e.SDK_NAME="@zyf2e/monitor",e.SDK_VERSION="2.1.28",e.errorBoundaryReport=function(e){if(m(e)){var n=X(e,B.Normal);n.type=t.REACT_ERROR,z.push({type:i.REACT,category:z.getCategory(i.REACT),data:n.name+": "+n.message,level:B.fromString(n.level)}),pe.send(n)}else console.warn("传入的react error不是一个object Error")},e.init=function(e){void 0===e&&(e={}),function(e){void 0===e&&(e={}),"XMLHttpRequest"in b&&!e.disabled&&(ie(e),ve())}(e)},e.log=function(e){var n=e.message,r=void 0===n?"emptyMsg":n,o=e.tag,a=void 0===o?"":o,s=e.level,c=void 0===s?B.Critical:s,u=e.ex,l=void 0===u?"":u,p={};m(l)&&(p=X(l,c));var f=Q({type:t.LOG_ERROR,level:c,message:F(r),name:"MITO.log",customTag:F(a),time:D(),url:T?G():P()},p);z.push({type:i.CUSTOMER,category:z.getCategory(i.CUSTOMER),data:r,level:B.fromString(c.toString())}),pe.send(f)},Object.defineProperty(e,"__esModule",{value:!0}),e}({});
